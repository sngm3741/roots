# フロントエンド共通ルール（マコトクラブ）

マコトクラブの **全ての画面設計書・フロント実装** に共通するルールをまとめたドキュメント。  
各画面ごとの md には、ここに書いてあることは **原則として重複して書かない**。  
差分だけを書くことで、設計と実装をシンプルに保つ。

---

## 0. 目的と位置づけ

- 目的
  - Codex / 開発者が「マコトクラブのフロント全体の前提」を共有するための土台
  - 各画面仕様書（例: `top-page.md`）で毎回同じことを書かなくていいようにする
  - デザイン・レイアウト・命名・実装方法の **一貫性** を担保する

- このドキュメントがカバーするもの
  - 技術スタックの前提
  - Grid / レイアウトの共通ルール
  - タイポグラフィ / カラーの共通ルール
  - コンポーネント利用方針（shadcn/ui）
  - データ・API・ルーティングの共通ルール
  - Codex への共通指示

---

## 1. 技術スタックの前提

- フレームワーク: **React Router v7（Framework Mode / 旧 Remix v3 相当）**
- 言語: **TypeScript**
- UI ライブラリ: **shadcn/ui**
- スタイル: **Tailwind CSS**
- ルーティング・データ取得:
  - React Router v7 の data router（loader / action）を使用
  - ファイルベースルーティング & SSR 前提
- ビルドターゲット: 基本はブラウザ + Cloudflare / Node ランタイム（詳細は別ドキュメント）

画面仕様書でこれと違うことをしたい場合は、  
**必ずその画面の md で「共通ルールからの例外」として明示すること。**

---

## 2. 画面設計書（md）の共通ルール

各画面ごとの仕様書（例: `docs/screens/top-page.md`）は、  
原則として以下の章立てをベースにする：

1. 画面の概要
2. 完成イメージ（セクション構造 / コンポーネント構造）
3. 画面固有の UI 仕様（共通ルールとの差分だけ）
4. データ仕様（型 / 必要なフィールド）
5. ユースケース / シナリオ
6. イベント仕様（クリック時・送信時の挙動）
7. バリデーション仕様
8. API 連携（あれば）
9. 権限・認可
10. この画面固有の Codex ルール（オプション）

**共通事項はこのドキュメントに集約し、  
画面仕様書では「この共通ルールに従う。差分は以下。」という書き方をする。**

---

## 3. レイアウト / Grid 共通ルール

### 3.1 ベースコンテナ

- ページ全体の横幅:
  - 基本: `max-w-5xl mx-auto px-4`
  - 特別に広いレイアウトが必要な場合のみ `max-w-6xl` などにする（画面仕様書で明示）
- セクションの縦余白:
  - 原則 `py-16`（モバイルでも PC でも共通）
  - 例外的に余白を増減させたい場合のみ画面仕様書で上書き指定

### 3.2 ブレークポイント

Tailwind の標準ブレークポイントに従う。

- `sm`: スマホ（〜640px）
- `md`: タブレット（641〜768px）
- `lg`: PC（769〜1024px）
- `xl` 以上: めったに個別調整しない。必要なときだけ。

**原則: モバイルファースト。  
まずは 1 カラムで崩れないようにし、`md:` 以上で分割する。**

### 3.3 12 Grid の考え方（抽象ルール）

実際には Tailwind の `grid-cols-*` を使うが、  
設計書・指示では **「12 カラム」を前提に比率で指定する**。

- 2 カラムレイアウトの例
  - 7:5 → `lg:grid-cols-[7fr_5fr]` 相当（実装では柔軟に）
  - 8:4 → `lg:grid-cols-[2fr_1fr]` 相当
- 3 カラムレイアウトの例
  - 均等割り: `grid-cols-1 md:grid-cols-3`
- カードグリッド:
  - `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6`

**Codex への指示の仕方（例）：**

- 「PC では 2 カラム（左: 7/12、右: 5/12）、スマホでは 1 カラム」
- 「カード一覧は、モバイル 1、タブレット 2、PC 3 カラム」

実装のための Tailwind クラスは Codex に任せるが、  
**比率・列数・ブレークポイントは必ず画面仕様書で指定する。**

---

## 4. タイポグラフィ / カラー 共通ルール

### 4.1 フォント / テキスト

- フォント:
  - デフォルトのシステムフォント（日本語 + ラテン）
- 見出し:
  - H1: `text-3xl md:text-4xl font-bold`
  - H2: `text-2xl font-semibold mb-6`
  - H3: `text-xl font-semibold`
- 本文:
  - `text-base leading-relaxed`
- 補足テキスト:
  - `text-sm text-muted-foreground`

画面仕様書では、特に変えたい場合のみ指定する。

### 4.2 カラー

- 基本方針:
  - ダークモードは当面考えない（必要になったら別途定義）
  - 白ベース + アクセント 1 色を「primary」として扱う
- Tailwind のカラートークン:
  - 背景: `bg-background` / `bg-card`
  - 文字: `text-foreground` / `text-muted-foreground`
  - アクセント: `bg-primary text-primary-foreground`

**どの具体色（#hex）を primary にするかは、  
グローバルテーマ側で決め、画面仕様書には原則書かない。**

---

## 5. コンポーネント利用方針（shadcn/ui）

### 5.1 原則

- UI は **可能な限り shadcn/ui コンポーネントを利用** し、  
  生の `<button>` / `<input>` などは避ける。
- よく使うコンポーネント:
  - `Button`, `Input`, `Textarea`, `Select`
  - `Card`, `Badge`, `Alert`, `Dialog`, `Tooltip`
  - `NavigationMenu` or 自前のヘッダーレイアウト
- 共通パターン（例: アンケートカード）は **専用コンポーネント** を切る
  - 例: `<SurveyCard summary={...} />`

### 5.2 Button の使い分け

- メイン CTA: `variant="default"`
- サブ CTA / サブアクション: `variant="outline"`
- 破壊的な操作（削除など）: `variant="destructive"`

画面仕様書では、  
「このボタンは Primary」「これは Secondary」程度を書けばよく、  
具体的な variant 名は Codex に任せてもよい。

---

## 6. データ / API / ルーティングの共通ルール

### 6.1 型定義

- 型定義は `app/types/` 配下にまとめる方針（例: `app/types/survey.ts`）
- プロパティ名は **キャメルケース**（例: `storeName`, `createdAt`）
- 画面仕様書には **その画面で必要なフィールドだけ** を列挙する

### 6.2 データ取得

- サーバーサイドデータ取得は **Remix の loader** を基本とする
- クライアントサイド fetch は「どうしても必要な場合のみ」採用
- loader 内では「リポジトリ層」を呼び出す構造にする（例: `surveyRepository.getLatestSurveys()`）

### 6.3 ルーティング

- 一覧系:
  - `/surveys`
  - `/areas`
- 詳細系:
  - `/surveys/:id`
  - `/areas/:code`
- 投稿系:
  - `/surveys/new`
- 店舗向け:
  - `/for-stores`

画面仕様書では、「このボタンを押すとどのパスに飛ぶか」を必ず書く。  
**クエリパラメータや検索条件がある場合は、そこだけ画面固有仕様として追記する。**

---

## 7. イベント / ナビゲーション共通ルール

- 画面遷移:
  - 基本は Remix の `<Link>` を使用
  - `window.location` や生の `<a>` は極力使わない
- フォーム送信:
  - Remix の `<Form>` と action（サーバー側）を基本とする
  - フロントのみで完結するバリデーション → `onSubmit` でハンドリングしてもよい
- クリックイベント:
  - ビジネスロジックをコンポーネント内にべったり書かない
  - 可能ならカスタムフックや別関数に切り出す

画面仕様書では、  
「どのイベントで、どの関数 or action が呼ばれるか」を明記する。

---

## 8. アクセシビリティ共通ルール（最低限）

- 画像には `alt` を必ずつける
- ボタンやリンクには、見た目だけでなくテキストラベル or `aria-label` を付与
- 見出しは論理的な順序（H1 → H2 → H3）でネストさせる
- フォーム要素には `label` を対応させる

画面仕様書では、特別なアクセシビリティ要件がある場合のみ追記。

---

## 9. Codex への共通指示（全画面共通）

Codex にフロントの実装を依頼するときは、  
**必ずこのドキュメントの存在を前提として指示する。**

例：

- 「技術スタックと UI ルールは `frontend-common.md` に従ってください」
- 「レイアウト・コンポーネント・タイポグラフィは共通ルールを使い、  
  この画面固有の差分は以下の仕様書に書いてあります」

共通指示：

1. このドキュメントおよび各画面仕様書に **書かれていない UI 要素を勝手に追加しない**。
2. Tailwind クラスは、原則コンポーネント側に直書きで構わないが、  
   共通化できると判断したもののみ抽出してよい。
3. 型定義は、仕様書のフィールド名を **一字一句変えずに** 採用すること。
4. 画面仕様書に記載のない API 呼び出しや状態管理は実装しない。
5. バリデーションやエラーハンドリングは、仕様書に例外系が書いてあるものだけに限定する。

---

## 10. レイアウト共通パーツ（ヘッダー / フッター）

### 10.1 ヘッダー
- ロゴリンク: `/`
- ナビゲーション例: `/stores` (店舗一覧), `/surveys` (アンケート一覧), `/surveys/new` (投稿)
- CTA: 必要なら右端に1つ（例: 「店舗を探す」または「投稿する」）
- レイアウト: `h-16`, `flex items-center justify-between`, コンテナは `max-w-5xl mx-auto px-4`
- モバイル: ハンバーガーメニューでドロワーを開く（ナビ項目＋CTAを内包）。アイコンは右上固定、開閉時はオーバーレイ表示。

### 10.2 フッター
- シンプルにテキストリンクのみ（例: `/terms`, `/privacy`, `contact mailto:`）
- コピーライト: `© MakotoClub`
- レイアウト: `py-8`, `text-sm text-muted-foreground`, コンテナは `max-w-5xl mx-auto px-4`

画面仕様書では、ヘッダー/フッターはこの共通ルールを使う前提とし、特別な変更がある場合のみ差分を書く。

---

## 10. 運用ルール

- このドキュメントに変更が入る場合:
  - 変更の影響範囲（どの画面に影響するか）を簡潔に追記すること
  - 可能なら「Breaking Change」「非互換なし」の区別をコメントとして残す
- 各画面仕様書からは、必要に応じて  
  「◯章の◯◯ルールに従う」「ここだけ上書きする」といった参照を書く

---

## 11. 次のアクション（太一向け）

1. この md を `docs/frontend-common.md` としてプロジェクトに置く  
2. 既に作った `top-page-spec.md` の中から、
   - レイアウト条件
   - タイポ・カラー
   - コンポーネントの基本ルール
   のうち「毎画面共通で良さそうな部分」はこのファイル側に寄せていく
3. 以後、新しい画面 md を作るときは必ず
   - 冒頭に「共通ルールに準拠し、差分はこの md に記載」と書く

この運用にしておくと、  
**「Codex に伝えるべき共通前提」が 1 ファイルに集約されるので、  
設計のブレ・UI のブレ・命名のブレをかなり潰せる。**
